# Inigo Quick Start


## Prerequisites

* Windows 7/8.1/10
* To create Inigo Expansions, an installation of CityEngine (2020.0 or later)
* For commercial work, a license for CityEngine (2020.0 or later)
* Unreal Engine 4.24 (optional)
* Vitruvio - City Engine Plugin for Unreal Engine 4 (optional)


## Installation

### From Pre-Built RPK 

1. [Download Inigo RPK](https://github.com/amybam/Inigo/blob/master/Inigo.rpk)
1. Move into your City Engine workspace directory, so that the RPK ends up in the `data` sub-directory.
1. Apply RPK to City Engine Geometry


### From Source

1. [Download Inigo Project File](https://github.com/amybam/Inigo/tree/master/CityEngineWorkspace) 
1. In City Engine, go to File > Import...
1. Select Project > Existing Projects into Workspace
1. Select the root directory and then the project to be imported
1. Once imported, CGA file in `rules` sub-directory can be applied to City Engine Geometry
1. To compile, right click CGA file > Share as..., and save as RPK file

### For Unreal Engine
1. [Install Vitruvio](https://community.esri.com/docs/DOC-14445-vitruvio-cityengine-plugin-for-unreal-engine-4) following directions provided
1. Move compiled RPK to `Vitruvio Content` folder
1. Load Unreal Engine Project
1. Use `BP_PRTActor` with the RPK to generate geometry


## Execute a simple CityEngine Rule
    
1. In CityEngine, create the following rule file and share it as a rule package (RPK) to disk somewhere (or download one of the provided examples):
   ```
   attr height = 1
   
   @StartRule
   Init -->
      extrude(height)
   ```
1. In Houdini, in a new scene, add a ``grid`` node.
1. Enter the ``grid`` node and add the two Palladio nodes ``pldAssign`` and ``pldGenerate``. Connect them like this: ![](img/extrude01.png)
1. In the ``pldAssign`` node, set the ``Rule Package`` parameter to the path of the previously exported RPK.
1. Make the ``pldGenerate`` node the active render node, this will trigger a "cooking" of the assign and generate nodes and execute the CityEngine Rule. You should now see an extruded grid: ![](img/extrude02.png)

## Overriding Rule Attributes

In the previous section we've used the default value for the ``height`` attribute. Let's use Houdini tools to modify the rule attribute prior to execution.

1. Right click on the ``pldAssign`` node and bring up the spreadsheet view. Observe how the ``height`` primitive parameter is set to 1 for all primitives. This is the rule attribute default value and we're going to override it now. ![](img/attribute01.png)
1. Add an ``AttributeCreate`` node between ``pldAssign`` and ``pldGenerate``.
1. Set the attribute name to ``height`` and the ``Class`` to ``Primitive``. The extrusion vanishes because the default value is 0.
1. Increase the value for ``height`` to see an actual extrusion: ![](img/attribute02.png)

## Working with Material Attributes

Note: we provide a ready-made Houdini Digital Asset with a [CityEngine Material for Mantra](https://github.com/Esri/palladio/releases/download/v1.6.1/PalladioCityEngineMaterial-v2.hdanc).

In this section, we are going to connect a material attribute generated by ``pldGenerate`` with a Mantra shader (the same mechanism can also be used for Viewport materials).

1. Extend the rule from the first section with a ``color`` statement:
    ```
    attr height = 1

    @StartRule
    Init -->
       color(1,0,0)
       extrude(height)
    ```
    ![](img/materials01.png) 
1. In Houdini, select the ``pldGenerate`` node and check the ``Emit material attributes`` check box. Open the spreadsheet to observe a number of material primitive attributes now being emitted by ``pldGenerate``.
1. Add a ``Material`` node and connect it to the ``pldGenerate`` node. Make it the active render node:
    
    ![](img/materials02.png)
1. In the ``Material Palette``, create a new ``Principled Shader`` instance and call it ``CityEngineShader``:

    ![](img/materials03.png)
1. Enter the ``CityEngineShader`` node and connect a ``Parameter`` node to the ``Surface/basecolor`` input:

    ![](img/materials04.png) 

1. Set the name of the ``Parameter`` node to ``color`` and also set the type to ``Color``. This name will match the primitive attribute emitted by ``pldGenerate``.

    ![](img/materials05.png)

1. Back in the network of the ``grid`` node, select the ``Material`` node and select ``/mat/CityEngineShader`` for the ``Material`` parameter.

1. Hit Mantra render and you should see a red box in the render view.

    ![](img/materials06.png)